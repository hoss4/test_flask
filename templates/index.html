<!DOCTYPE html>
<html>
<head>
    <title>Railway PostgreSQL Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .connected { color: green; }
        .disconnected { color: red; }
        .message { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        form { margin: 20px 0; }
        input, button { padding: 10px; margin: 5px; }
    </style>
</head>
<body>
    <h1>üöÑ Railway PostgreSQL Connection Test</h1>
    
    {% if connected %}
        <h2 class="connected">‚úÖ Successfully connected to PostgreSQL!</h2>
    {% else %}
        <h2 class="disconnected">‚ùå Database connection failed</h2>
        <p><strong>Error:</strong> {{ error }}</p>
    {% endif %}

    <div>
        <h3>Test Messages from Database:</h3>
        {% if messages %}
            {% for msg in messages %}
                <div class="message">
                    <strong>#{{ msg[0] }}</strong>: {{ msg[1] }} 
                    <br><small>{{ msg[2] }}</small>
                </div>
            {% endfor %}
        {% else %}
            <p>No messages found in database.</p>
        {% endif %}
    </div>

    <form id="messageForm">
        <h3>Add New Test Message:</h3>
        <input type="text" name="message" placeholder="Enter a test message" value="Hello from the web!" required>
        <button type="submit">Add Message</button>
    </form>

    <div>
        <h3>Health Check:</h3>
        <a href="/health" target="_blank">Check API Health</a>
    </div>

    <script>
        document.getElementById('messageForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            
            try {
                const response = await fetch('/add-message', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();
                
                if (result.success) {
                    alert('Message added successfully! Refresh the page to see it.');
                    this.reset();
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                alert('Network error: ' + error);
            }
        });
    </script>
</body>
</html>